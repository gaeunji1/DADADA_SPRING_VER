<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ktdsuniversity.proj.dadada.member.dao.MemberDAO">

    <insert id="insertMember" parameterType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
        <selectKey keyProperty="mbrId" resultType="int" order="BEFORE">
            SELECT seq_mbr_id.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO MBR (
            MBR_ID, MBR_INS_ID, MBR_EMAIL, MBR_PWD, MBR_NCKNM,
            MBR_PSTL_CD, MBR_ADDR1, MBR_ADDR2,
            ADMIN_YN, BNFT_CNT, STACK_DSCNT_RT, SALT, MBR_PH_NO
        )
        VALUES (
            #{mbrId}, #{mbrInsId}, #{mbrEmail}, #{mbrPwd}, #{mbrNcknm},
            #{mbrPstlCd}, #{mbrAddr1}, #{mbrAddr2},
            #{adminYn}, #{bnftCnt}, #{stackDscntRt}, #{salt}, #{mbrPhNo}
        )
    </insert>

    <!-- 로그인 시 회원 정보 조회 (아이디와 비밀번호로) -->
    <select id="loginMember" parameterType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO"
            resultType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
        SELECT MBR_ID, MBR_INS_ID, MBR_EMAIL, MBR_PWD, MBR_NCKNM,
            MBR_PSTL_CD, MBR_ADDR1, MBR_ADDR2,
            ADMIN_YN, BNFT_CNT, STACK_DSCNT_RT, SALT, MBR_PH_NO
          FROM MBR
         WHERE MBR_INS_ID = #{mbrInsId}
           AND MBR_PWD = #{mbrPwd}
    </select>

    <!-- 아이디(MBR_INS_ID)로 회원 정보 조회 -->
    <select id="findMemberByMbrInsId" parameterType="String"
            resultType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
        SELECT MBR_ID, MBR_INS_ID, MBR_EMAIL, MBR_PWD, MBR_NCKNM,
            MBR_PSTL_CD, MBR_ADDR1, MBR_ADDR2,
            ADMIN_YN, BNFT_CNT, STACK_DSCNT_RT, SALT, MBR_PH_NO
          FROM MBR
         WHERE MBR_INS_ID = #{mbrInsId}
    </select>
    
    <!-- 회원 수 조회 (ID 중복 체크 등) -->
    <select id="countById" parameterType="string" resultType="int">

        SELECT COUNT(*) 
          FROM MBR 
        WHERE MBR_INS_ID = #{mbrInsId}

    </select>
    
    <update id="decrementBonusCount" parameterType="int">
        UPDATE MBR
           SET BNFT_CNT = BNFT_CNT - 1
         WHERE MBR_ID = #{memId}
           AND BNFT_CNT > 0
    </update>

    <select id="getBonusCountBy" parameterType="int" resultType="int">
        SELECT BNFT_CNT FROM MBR WHERE MBR_ID = #{memId}
    </select>
    
    <select id="selectMemberById" resultType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO" parameterType="int">
        SELECT * FROM MBR WHERE MBR_ID = #{mbrId}
    </select>

    <update id="updateMember" parameterType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
        UPDATE MBR
           SET MBR_EMAIL   = #{mbrEmail},
               MBR_NCKNM   = #{mbrNcknm},
               MBR_PSTL_CD = #{mbrPstlCd},
               MBR_ADDR1   = #{mbrAddr1},
               MBR_ADDR2   = #{mbrAddr2},
               MBR_PWD     = #{mbrPwd},
               MBR_PH_NO   = #{mbrPhNo}
         WHERE MBR_ID     = #{mbrId}
    </update>

    <delete id="deleteMemberById" parameterType="int">
        DELETE FROM MBR
         WHERE MBR_ID = #{mbrId}
    </delete>

    <select id="getMemberByInsId" parameterType="string" resultType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
        SELECT MBR_ID, MBR_INS_ID, MBR_EMAIL, MBR_PWD, MBR_NCKNM,
            MBR_PSTL_CD, MBR_ADDR1, MBR_ADDR2,
            ADMIN_YN, BNFT_CNT, STACK_DSCNT_RT, SALT, MBR_PH_NO 
          FROM MBR 
         WHERE MBR_INS_ID = #{mbrInsId}
    </select>
    
<select id="selectAllBenefitNames" resultType="string">
    SELECT BNFT_NM
      FROM RLT_BNFT
     ORDER BY BNFT_ID
</select>

    <update id="addBenefitCount"
            parameterType="com.ktdsuniversity.proj.dadada.member.vo.BenefitCountVO">
      UPDATE MBR
      SET BNFT_CNT = NVL(BNFT_CNT, 0) + #{count}
      WHERE MBR_ID   = #{mbrId}
    </update>
    
    
  <select id="selectMemberForShipping"
          parameterType="int"
          resultType="com.ktdsuniversity.proj.dadada.member.vo.MemberVO">
    SELECT  MBR_ID,
            MBR_NCKNM,
            MBR_PH_NO,
            MBR_ADDR1,
            MBR_ADDR2,
            MBR_PSTL_CD
      FROM  MBR
     WHERE  MBR_ID = #{mbrId}
  </select>

</mapper>